
# **プロジェクト概要-BulkMigrator**　

このプロジェクトは、組織用 OneDrive から同組織の SharePoint へ **大容量ファイル群を効率的かつ安全に転送するためのスクリプト群** を構築することを目指します。

---

## **基本仕様**

1. **ファイル転送の規模**  
   - 数百GBに及ぶファイル群を対象。
   - ディレクトリ構造を完全に保持した状態でコピー。

2. **堅牢性の追求**  
   - ネットワークエラー、PCダウン、意図的な作業中断への対応。
   - いつでも再開可能なシステム設計。

3. **ログおよびインデックス管理**  
   - 転送状況をログファイルで記録。
   - インデックスを用いて効率化し、重複アップロードを防止。

4. **設定の一元化**
   - config.jsonなどを用いて設定情報を一元管理する。

5. **転送成功後**
   - 厳密な比較を行うスクリプト(ハッシュ値比較など)にて整合性をチェック。
   - 確実に転送が完了したと判断されれば、安全に転送元の削除も行う。
   - また、チェックサムレポートを作成し、再転送も安全に行えるようにする。
   - 削除ログも記録し不測の事態に備える。

---

## **転送ロジック**

1. **GraphAPI を活用**  
   - **OneDrive側**：ダウンロードURLを取得。  
   - **SharePoint側**：PUTリクエストで直接転送。  
   - ダウンロードとアップロードの工程を省略することで高速化。

2. **再帰的処理**  
   - 転送元のディレクトリ構造を再帰的に取得。
   - 転送先でのディレクトリ展開を実現。

3. **スキップリスト生成**  
   - 転送済みファイルはログで管理。
   - 次回以降はスキップ対象として認識。

---

## **異常時対応**

1. **ログ破綻時の復旧**  
   - 転送先をクロールし、最新状態に基づいてスキップリストを再構築。
   - OndriveとSharePoint間のファイル名規則の違いに配慮する。

2. **転送失敗への対応**  
   - 再試行時に失敗箇所を特定し、効率的に処理を進める。
   - 標準出力のバランスに気をつけ、多すぎず、不安にならない程度の粒度を心がける。
   - ログファイルの出力もデバッグを考えconfigで調節できるようにあらかじめ設定する。

## **セキュリティ**

1. **機密情報の扱い**
   - GraphAPIのシークレットキー等、機密情報の扱いに気をつけ、環境変数を利用しセキュリティを意識。
   - 環境変数への設定をコピペで済ませられるようなセットアップスクリプトも用意する。
   - ポリシーによってはconfigファイルに置くことも可能にする柔軟な設計。