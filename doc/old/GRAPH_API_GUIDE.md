# ğŸŒ Graph API æƒ…å ±å–å¾—ã‚¬ã‚¤ãƒ‰

**Microsoft Graph Exploreræ´»ç”¨ã«ã‚ˆã‚‹å¿…è¦IDå–å¾—ã®å®Œå…¨æ‰‹é †**

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€OneDriveâ†’SharePointç§»è¡Œãƒ„ãƒ¼ãƒ«ã§å¿…è¦ãªå„ç¨®IDã‚’ã€Microsoft Graph Explorerã‚’ä½¿ç”¨ã—ã¦åŠ¹ç‡çš„ã«å–å¾—ã™ã‚‹æ–¹æ³•ã‚’è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚

> ğŸ’¡ **åˆå¿ƒè€…ã®æ–¹ã¸**: ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€ã‚ãªãŸã®ç’°å¢ƒã«åˆã‚ã›ã¦å¤‰æ›´ãŒå¿…è¦ãªéƒ¨åˆ†ã‚’ `<<>>` ã§å›²ã‚“ã§è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚å®Ÿéš›ã«ä½¿ç”¨ã™ã‚‹éš›ã¯ã€`<<>>` ã‚’å«ã‚ã¦ã€ã‚ãªãŸã®ç’°å¢ƒã®å®Ÿéš›ã®å€¤ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

---

## ğŸ“‹ å¿…è¦ãªæƒ…å ±ä¸€è¦§

ç§»è¡Œãƒ„ãƒ¼ãƒ«ã§å¿…è¦ã¨ãªã‚‹ä¸»è¦ãªæƒ…å ±ï¼š

| é …ç›® | èª¬æ˜ | å–å¾—æ–¹æ³• |
|------|------|----------|
| **ãƒ†ãƒŠãƒ³ãƒˆID** | Azure ADã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªID | çµ„ç¹”æƒ…å ±ã‹ã‚‰å–å¾— |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼ID** | OneDriveã®å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ID | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ã§å–å¾— |
| **ã‚µã‚¤ãƒˆID** | SharePointã‚µã‚¤ãƒˆã®è­˜åˆ¥å­ | ã‚µã‚¤ãƒˆæ¤œç´¢ã§å–å¾— |
| **ãƒ‰ãƒ©ã‚¤ãƒ–ID** | SharePointãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªID | ã‚µã‚¤ãƒˆã®ãƒ‰ãƒ©ã‚¤ãƒ–ä¸€è¦§ã‹ã‚‰å–å¾— |

---

## ğŸš€ Graph Explorer ã®æº–å‚™

### 1. Graph Explorer ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

[Microsoft Graph Explorer](https://developer.microsoft.com/ja-jp/graph/graph-explorer) ã‚’é–‹ãã¾ã™ã€‚

### 2. ã‚µã‚¤ãƒ³ã‚¤ãƒ³

1. å³ä¸Šã® **ã€Œã‚µã‚¤ãƒ³ã‚¤ãƒ³ã€** ã‚’ã‚¯ãƒªãƒƒã‚¯
2. çµ„ç¹”ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆAzure ADï¼‰ã§ãƒ­ã‚°ã‚¤ãƒ³
3. å¿…è¦ã«å¿œã˜ã¦æ¨©é™ã®åŒæ„ã‚’è¡Œã†

### 3. æ¨©é™ã®ç¢ºèª

å·¦å´ã®ãƒ‘ãƒãƒ«ã§ä»¥ä¸‹ã®æ¨©é™ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š
- `User.Read`
- `Sites.Read.All` ã¾ãŸã¯ `Sites.ReadWrite.All`
- `Files.Read` ã¾ãŸã¯ `Files.ReadWrite.All`

> âš ï¸ **é‡è¦**: Graph Explorerã¯ä¸€æ™‚çš„ãªæ¤œè¨¼ç”¨ã§ã™ã€‚å®Ÿéš›ã®ç§»è¡Œãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã«ã¯ã€Azure ADã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç™»éŒ²ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒå¿…è¦ã§ã™ã€‚
>
> **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«é–¢ã™ã‚‹é‡è¦ãªæ³¨æ„**:
> - ä½œæˆæ™‚ã«ä¸€åº¦ã ã‘è¡¨ç¤ºã•ã‚Œã¾ã™
> - **ä¿å­˜ã—å¿˜ã‚Œã‚‹ã¨äºŒåº¦ã¨ç¢ºèªã§ãã¾ã›ã‚“**
> - ç´›å¤±ã—ãŸå ´åˆã¯æ–°ã—ã„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
> - å®‰å…¨ãªå ´æ‰€ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãªã©ï¼‰ã«å¿…ãšä¿å­˜ã—ã¦ãã ã•ã„

---

## ğŸ” Step 1: ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã®å–å¾—

### ã‚¯ã‚¨ãƒªå®Ÿè¡Œ

```http
GET https://graph.microsoft.com/v1.0/organization
```

### å®Ÿè¡Œæ‰‹é †

1. Graph Explorerã®ã‚¯ã‚¨ãƒªãƒœãƒƒã‚¯ã‚¹ã«ä¸Šè¨˜URLã‚’å…¥åŠ›
2. **ã€Œã‚¯ã‚¨ãƒªã®å®Ÿè¡Œã€** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ä»¥ä¸‹ã®æƒ…å ±ã‚’ç¢ºèªï¼š

**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**:
```json
{
  "value": [
    {
      "id": "<<ã‚ãªãŸã®çµ„ç¹”ã®ãƒ†ãƒŠãƒ³ãƒˆID>>",
      "displayName": "<<ã‚ãªãŸã®ä¼šç¤¾å>>",
      "verifiedDomains": [
        {
          "name": "<<ä¼šç¤¾å>>.onmicrosoft.com"
        }
      ]
    }
  ]
}
```

**å®Ÿä¾‹**:
```json
{
  "value": [
    {
      "id": "12345678-1234-1234-1234-123456789012",
      "displayName": "Contosoæ ªå¼ä¼šç¤¾",
      "verifiedDomains": [
        {
          "name": "contoso.onmicrosoft.com"
        }
      ]
    }
  ]
}
```

### ğŸ“ å–å¾—æƒ…å ±

- **ãƒ†ãƒŠãƒ³ãƒˆID**: `id` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤
- **çµ„ç¹”å**: `displayName` ã§æ­£ã—ã„çµ„ç¹”ã‹ç¢ºèª
- **ãƒ‰ãƒ¡ã‚¤ãƒ³**: `verifiedDomains` ã§çµ„ç¹”ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèª

---

## ğŸ‘¤ Step 2: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—

### æ–¹æ³•1: è‡ªåˆ†ã®æƒ…å ±ã‚’å–å¾—

```http
GET https://graph.microsoft.com/v1.0/me
```

**ä½¿ç”¨å ´é¢**: è‡ªåˆ†ã®OneDriveã‹ã‚‰ç§»è¡Œã™ã‚‹å ´åˆ

### æ–¹æ³•2: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—

```http
GET https://graph.microsoft.com/v1.0/users/<<ã‚ãªãŸã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹@ä¼šç¤¾å.com>>
```

**ä½¿ç”¨å ´é¢**: ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒåˆ†ã‹ã£ã¦ã„ã‚‹å ´åˆ

**å®Ÿä¾‹**:
```http
GET https://graph.microsoft.com/v1.0/users/yamada@contoso.onmicrosoft.com
```

### æ–¹æ³•3: è¡¨ç¤ºåã§æ¤œç´¢

```http
GET https://graph.microsoft.com/v1.0/users?$filter=startswith(displayName,'<<æ¤œç´¢ã—ãŸã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå‰>>')
```

**ä½¿ç”¨å ´é¢**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡¨ç¤ºåãŒåˆ†ã‹ã£ã¦ã„ã‚‹å ´åˆ

**å®Ÿä¾‹**:
```http
GET https://graph.microsoft.com/v1.0/users?$filter=startswith(displayName,'å±±ç”°å¤ªéƒ')
```

### æ–¹æ³•4: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‹ã‚‰æ¤œç´¢

```http
GET https://graph.microsoft.com/v1.0/users?$select=id,displayName,mail,userPrincipalName&$top=50
```

**ä½¿ç”¨å ´é¢**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä¸€è¦§ã‹ã‚‰é¸æŠã—ãŸã„å ´åˆ

### ğŸ“ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

```json
{
  "id": "abcdefgh-1234-5678-9012-ijklmnopqrst",
  "displayName": "<<ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡¨ç¤ºå>>",
  "mail": "<<ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹>>",
  "userPrincipalName": "<<ãƒ¦ãƒ¼ã‚¶ãƒ¼@ä¼šç¤¾å.onmicrosoft.com>>"
}
```

**å®Ÿä¾‹**:
```json
{
  "id": "abcdefgh-1234-5678-9012-ijklmnopqrst",
  "displayName": "å±±ç”°å¤ªéƒ",
  "mail": "yamada@contoso.com",
  "userPrincipalName": "yamada@contoso.onmicrosoft.com"
}
```

### ğŸ“ å–å¾—æƒ…å ±

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ID**: `id` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ï¼ˆã“ã‚ŒãŒè¨­å®šã§å¿…è¦ï¼‰
- **è¡¨ç¤ºå**: `displayName` ã§å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ç¢ºèª
- **ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹**: `mail` ã¾ãŸã¯ `userPrincipalName` ã§ç¢ºèª

---

## ğŸ¢ Step 3: SharePoint ã‚µã‚¤ãƒˆæƒ…å ±ã®å–å¾—

### æ–¹æ³•1: ã‚µã‚¤ãƒˆURLã§ç›´æ¥å–å¾—

```http
GET https://graph.microsoft.com/v1.0/sites/<<ä¼šç¤¾å>>.sharepoint.com:/sites/<<ã‚µã‚¤ãƒˆå>>
```

**ä½¿ç”¨å ´é¢**: SharePointã‚µã‚¤ãƒˆã®URLãŒåˆ†ã‹ã£ã¦ã„ã‚‹å ´åˆ

**å®Ÿä¾‹**:
```http
GET https://graph.microsoft.com/v1.0/sites/contoso.sharepoint.com:/sites/musicarchive
```

#### URLæ§‹æˆã®èª¬æ˜
- `<<ä¼šç¤¾å>>.sharepoint.com`: SharePointã®ãƒ›ã‚¹ãƒˆå
- `/sites/<<ã‚µã‚¤ãƒˆå>>`: ã‚µã‚¤ãƒˆã®ãƒ‘ã‚¹

### æ–¹æ³•2: ã‚µã‚¤ãƒˆåã§æ¤œç´¢

```http
GET https://graph.microsoft.com/v1.0/sites?search=<<æ¤œç´¢ã—ãŸã„ã‚µã‚¤ãƒˆå>>
```

**ä½¿ç”¨å ´é¢**: ã‚µã‚¤ãƒˆåã§ã®æ¤œç´¢

**å®Ÿä¾‹**:
```http
GET https://graph.microsoft.com/v1.0/sites?search=musicarchive
```

### æ–¹æ³•3: å…¨ã‚µã‚¤ãƒˆä¸€è¦§

```http
GET https://graph.microsoft.com/v1.0/sites?$select=id,webUrl,displayName&$top=50
```

**ä½¿ç”¨å ´é¢**: åˆ©ç”¨å¯èƒ½ãªã‚µã‚¤ãƒˆã‚’ä¸€è¦§ã‹ã‚‰é¸æŠ

### ğŸ“ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

```json
{
  "id": "<<ä¼šç¤¾å>>.sharepoint.com,<<GUID1>>,<<GUID2>>",
  "webUrl": "https://<<ä¼šç¤¾å>>.sharepoint.com/sites/<<ã‚µã‚¤ãƒˆå>>",
  "displayName": "<<ã‚µã‚¤ãƒˆã®è¡¨ç¤ºå>>",
  "name": "<<ã‚µã‚¤ãƒˆå>>"
}
```

**å®Ÿä¾‹**:
```json
{
  "id": "contoso.sharepoint.com,12345678-abcd-efgh-ijkl-123456789012,87654321-dcba-hgfe-lkji-210987654321",
  "webUrl": "https://contoso.sharepoint.com/sites/musicarchive",
  "displayName": "éŸ³æ¥½ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–",
  "name": "musicarchive"
}
```

### ğŸ“ å–å¾—æƒ…å ±

- **ã‚µã‚¤ãƒˆID**: `id` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ï¼ˆãƒ‰ãƒ©ã‚¤ãƒ–å–å¾—ã§ä½¿ç”¨ï¼‰
- **ã‚µã‚¤ãƒˆURL**: `webUrl` ã‹ã‚‰è¨­å®šå€¤ã‚’åˆ†é›¢
  - `target_site_hostname`: `<<ä¼šç¤¾å>>.sharepoint.com`
  - `target_site_path`: `/sites/<<ã‚µã‚¤ãƒˆå>>`

**å®Ÿä¾‹**:
- `target_site_hostname`: `contoso.sharepoint.com`
- `target_site_path`: `/sites/musicarchive`

---

## ğŸ“ Step 4: ãƒ‰ãƒ©ã‚¤ãƒ–æƒ…å ±ã®å–å¾—

### ã‚¯ã‚¨ãƒªå®Ÿè¡Œ

```http
GET https://graph.microsoft.com/v1.0/sites/<<Step3ã§å–å¾—ã—ãŸã‚µã‚¤ãƒˆID>>/drives
```

`<<Step3ã§å–å¾—ã—ãŸã‚µã‚¤ãƒˆID>>` ã¯ Step 3 ã§å–å¾—ã—ãŸã‚µã‚¤ãƒˆIDã«ç½®ãæ›ãˆã¾ã™ã€‚

### å®Ÿè¡Œä¾‹

```http
GET https://graph.microsoft.com/v1.0/sites/contoso.sharepoint.com,12345678-abcd-efgh-ijkl-123456789012,87654321-dcba-hgfe-lkji-210987654321/drives
```

### ğŸ“ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

```json
{
  "value": [
    {
      "id": "<<ãƒ‰ãƒ©ã‚¤ãƒ–ID1>>",
      "name": "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",
      "driveType": "documentLibrary",
      "webUrl": "https://<<ä¼šç¤¾å>>.sharepoint.com/sites/<<ã‚µã‚¤ãƒˆå>>/Shared%20Documents"
    },
    {
      "id": "<<ãƒ‰ãƒ©ã‚¤ãƒ–ID2>>",
      "name": "ç”»åƒ",
      "driveType": "documentLibrary",
      "webUrl": "https://<<ä¼šç¤¾å>>.sharepoint.com/sites/<<ã‚µã‚¤ãƒˆå>>/Images"
    }
  ]
}
```

**å®Ÿä¾‹**:
```json
{
  "value": [
    {
      "id": "b!AbCdEfGhIjKlMnOpQrStUvWxYz1234567890",
      "name": "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",
      "driveType": "documentLibrary",
      "webUrl": "https://contoso.sharepoint.com/sites/musicarchive/Shared%20Documents"
    },
    {
      "id": "b!XyZwVuTsRqPoNmLkJiHgFeDcBa9876543210",
      "name": "ç”»åƒ",
      "driveType": "documentLibrary",
      "webUrl": "https://contoso.sharepoint.com/sites/musicarchive/Images"
    }
  ]
}
```

### ğŸ“ å–å¾—æƒ…å ±

- **ãƒ‰ãƒ©ã‚¤ãƒ–ID**: `id` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ï¼ˆé€šå¸¸ã¯ã€Œãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é¸æŠï¼‰
- **ãƒ‰ãƒ©ã‚¤ãƒ–å**: `name` ã§å¯¾è±¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ç¢ºèª
- **ãƒ‰ãƒ©ã‚¤ãƒ–URL**: `webUrl` ã§ç¢ºèª

---

## ğŸ” Step 5: è¨­å®šå€¤ã®æ•´ç†

### å–å¾—ã—ãŸæƒ…å ±ã‚’è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç”¨ã«æ•´ç†

| è¨­å®šé …ç›® | å–å¾—å…ƒ | è¨­å®šä¾‹ |
|---------|-------|--------|
| `tenant_id` | Step 1 çµ„ç¹”æƒ…å ± | `<<Step1ã§å–å¾—ã—ãŸãƒ†ãƒŠãƒ³ãƒˆID>>` |
| `onedrive_user_id` | Step 2 ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± | `<<Step2ã§å–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ID>>` |
| `target_site_hostname` | Step 3 ã‚µã‚¤ãƒˆ webUrl | `<<ä¼šç¤¾å>>.sharepoint.com` |
| `target_site_path` | Step 3 ã‚µã‚¤ãƒˆ webUrl | `/sites/<<ã‚µã‚¤ãƒˆå>>` |
| `target_drive_id` | Step 4 ãƒ‰ãƒ©ã‚¤ãƒ–æƒ…å ± | `<<Step4ã§å–å¾—ã—ãŸãƒ‰ãƒ©ã‚¤ãƒ–ID>>` |

**å®Ÿä¾‹**:
| è¨­å®šé …ç›® | å–å¾—å…ƒ | è¨­å®šä¾‹ |
|---------|-------|--------|
| `tenant_id` | Step 1 çµ„ç¹”æƒ…å ± | `12345678-1234-1234-1234-123456789012` |
| `onedrive_user_id` | Step 2 ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± | `abcdefgh-1234-5678-9012-ijklmnopqrst` |
| `target_site_hostname` | Step 3 ã‚µã‚¤ãƒˆ webUrl | `contoso.sharepoint.com` |
| `target_site_path` | Step 3 ã‚µã‚¤ãƒˆ webUrl | `/sites/musicarchive` |
| `target_drive_id` | Step 4 ãƒ‰ãƒ©ã‚¤ãƒ–æƒ…å ± | `b!AbCdEfGhIjKlMnOpQrStUvWxYz1234567890` |

### config.json ã¸ã®åæ˜ ä¾‹

**ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**:
```json
{
  "tenant_id": "<<Step1ã§å–å¾—ã—ãŸãƒ†ãƒŠãƒ³ãƒˆID>>",
  "onedrive_user_id": "<<Step2ã§å–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ID>>",
  "target_site_hostname": "<<ä¼šç¤¾å>>.sharepoint.com",
  "target_site_path": "/sites/<<ã‚µã‚¤ãƒˆå>>",
  "target_drive_id": "<<Step4ã§å–å¾—ã—ãŸãƒ‰ãƒ©ã‚¤ãƒ–ID>>",
  "target_drive_name": "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",
  "target_root_path": "<<ç§»è¡Œå…ˆãƒ•ã‚©ãƒ«ãƒ€å>>",
  "source_onedrive_path": "<<ç§»è¡Œå…ƒãƒ•ã‚©ãƒ«ãƒ€å>>"
}
```

**å®Ÿä¾‹**:
```json
{
  "tenant_id": "12345678-1234-1234-1234-123456789012",
  "onedrive_user_id": "abcdefgh-1234-5678-9012-ijklmnopqrst",
  "target_site_hostname": "contoso.sharepoint.com",
  "target_site_path": "/sites/musicarchive",
  "target_drive_id": "b!AbCdEfGhIjKlMnOpQrStUvWxYz1234567890",
  "target_drive_name": "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",
  "target_root_path": "éŸ³æ¥½",
  "source_onedrive_path": "Music"
}
```

---

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. æ¨©é™ã‚¨ãƒ©ãƒ¼

```json
{
  "error": {
    "code": "Forbidden",
    "message": "Insufficient privileges to complete the operation."
  }
}
```

**è§£æ±ºæ–¹æ³•:**
- Graph Explorerã§å¿…è¦ãªæ¨©é™ã«åŒæ„
- Azure ADã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§é©åˆ‡ãªæ¨©é™ã‚’è¨­å®š
- ç®¡ç†è€…ã«æ¨©é™ä»˜ä¸ã‚’ä¾é ¼

#### 2. ã‚µã‚¤ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„

```json
{
  "error": {
    "code": "itemNotFound",
    "message": "The requested item was not found."
  }
}
```

**è§£æ±ºæ–¹æ³•:**
- ã‚µã‚¤ãƒˆURLã®ç¢ºèªï¼ˆå¤§æ–‡å­—å°æ–‡å­—ã€ã‚¹ãƒšãƒ«ãƒŸã‚¹ï¼‰
- ã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®ç¢ºèª
- ã‚µã‚¤ãƒˆæ¤œç´¢ã‚¯ã‚¨ãƒªã§å­˜åœ¨ç¢ºèª

#### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**è§£æ±ºæ–¹æ³•:**
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¢ºèª
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®Active Directoryä¸Šã§ã®å­˜åœ¨ç¢ºèª
- è¡¨ç¤ºåã§ã®æ¤œç´¢ã‚’è©¦è¡Œ

#### 4. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒé•·ã™ãã‚‹

**è§£æ±ºæ–¹æ³•:**
- `$top` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã‚’åˆ¶é™
- `$select` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§å¿…è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿å–å¾—
- `$filter` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ¡ä»¶æŒ‡å®š

### ãƒ‡ãƒãƒƒã‚°ç”¨ã‚¯ã‚¨ãƒª

#### ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ç¢ºèª
```http
GET https://graph.microsoft.com/v1.0/me/memberOf
```

#### ã‚µã‚¤ãƒˆã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ç¢ºèª
```http
GET https://graph.microsoft.com/v1.0/sites/{site-id}/permissions
```

#### ãƒ‰ãƒ©ã‚¤ãƒ–ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª
```http
GET https://graph.microsoft.com/v1.0/drives/{drive-id}/root
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

### Microsoft Graph API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Graph Explorer](https://developer.microsoft.com/ja-jp/graph/graph-explorer)
- [Users API](https://docs.microsoft.com/ja-jp/graph/api/resources/user)
- [Sites API](https://docs.microsoft.com/ja-jp/graph/api/resources/site)
- [Drives API](https://docs.microsoft.com/ja-jp/graph/api/resources/drive)

### OData ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

- `$select`: å–å¾—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æŒ‡å®š
- `$filter`: æ¡ä»¶ãƒ•ã‚£ãƒ«ã‚¿
- `$top`: å–å¾—ä»¶æ•°åˆ¶é™
- `$skip`: ã‚¹ã‚­ãƒƒãƒ—ä»¶æ•°
- `$orderby`: ã‚½ãƒ¼ãƒˆé †åº

### ä¾¿åˆ©ãªãƒ•ã‚£ãƒ«ã‚¿ä¾‹

```http
# ç‰¹å®šãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
GET /v1.0/users?$filter=endswith(mail,'@<<ä¼šç¤¾ãƒ‰ãƒ¡ã‚¤ãƒ³>>')

# æœ€è¿‘æ›´æ–°ã•ã‚ŒãŸã‚µã‚¤ãƒˆ
GET /v1.0/sites?$filter=lastModifiedDateTime gt 2024-01-01T00:00:00Z

# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿
GET /v1.0/sites/<<ã‚µã‚¤ãƒˆID>>/drives?$filter=driveType eq 'documentLibrary'
```

**å®Ÿä¾‹**:
```http
# è…åŸå»ºè¨­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
GET /v1.0/users?$filter=endswith(mail,'@contoso.com')

# æœ€è¿‘æ›´æ–°ã•ã‚ŒãŸã‚µã‚¤ãƒˆ
GET /v1.0/sites?$filter=lastModifiedDateTime gt 2024-01-01T00:00:00Z

# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿
GET /v1.0/sites/contoso.sharepoint.com,12345678-abcd-efgh-ijkl-123456789012,87654321-dcba-hgfe-lkji-210987654321/drives?$filter=driveType eq 'documentLibrary'
```

---

## ğŸ¯ åŠ¹ç‡çš„ãªä½œæ¥­ãƒ•ãƒ­ãƒ¼

### æ¨å¥¨æ‰‹é †

1. **Graph Explorer ã§ãƒ­ã‚°ã‚¤ãƒ³**: çµ„ç¹”ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªè¨¼
2. **çµ„ç¹”æƒ…å ±ç¢ºèª**: ãƒ†ãƒŠãƒ³ãƒˆIDã¨çµ„ç¹”åã‚’ç¢ºèª
3. **å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ç‰¹å®š**: ç§»è¡Œå…ƒOneDriveã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
4. **ç§»è¡Œå…ˆã‚µã‚¤ãƒˆç¢ºèª**: SharePointã‚µã‚¤ãƒˆIDã¨URLã‚’å–å¾—
5. **ãƒ‰ãƒ©ã‚¤ãƒ–é¸æŠ**: ç§»è¡Œå…ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®IDã‚’å–å¾—
6. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**: å–å¾—ã—ãŸæƒ…å ±ã§config.jsonã‚’æ›´æ–°

### ğŸ• ä½œæ¥­æ™‚é–“ç›®å®‰

- **åˆå›**: 15-20åˆ†ï¼ˆæ¨©é™è¨­å®šå«ã‚€ï¼‰
- **2å›ç›®ä»¥é™**: 5-10åˆ†ï¼ˆæ‰‹é †ç†ŸçŸ¥å¾Œï¼‰

### ğŸ“ ä½œæ¥­è¨˜éŒ²ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

**ä»¥ä¸‹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«è¨˜å…¥ã—ãªãŒã‚‰ä½œæ¥­ã™ã‚‹ã¨åŠ¹ç‡çš„ã§ã™**ï¼š

```
ã€Graph APIæƒ…å ±å–å¾—ä½œæ¥­è¨˜éŒ²ã€‘
æ—¥æ™‚: <<è¨˜å…¥æ—¥æ™‚>>

â–  Step 1: ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±
- ãƒ†ãƒŠãƒ³ãƒˆID: <<å–å¾—ã—ãŸãƒ†ãƒŠãƒ³ãƒˆID>>
- çµ„ç¹”å: <<ç¢ºèªã—ãŸçµ„ç¹”å>>

â–  Step 2: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±  
- å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼: <<ãƒ¦ãƒ¼ã‚¶ãƒ¼å>>
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: <<ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹>>
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <<å–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ID>>

â–  Step 3: ã‚µã‚¤ãƒˆæƒ…å ±
- ã‚µã‚¤ãƒˆURL: <<ã‚µã‚¤ãƒˆURL>>
- ã‚µã‚¤ãƒˆå: <<ã‚µã‚¤ãƒˆå>>
- ã‚µã‚¤ãƒˆID: <<å–å¾—ã—ãŸã‚µã‚¤ãƒˆID>>

â–  Step 4: ãƒ‰ãƒ©ã‚¤ãƒ–æƒ…å ±
- ãƒ‰ãƒ©ã‚¤ãƒ–å: <<ãƒ‰ãƒ©ã‚¤ãƒ–åï¼ˆé€šå¸¸ã¯ã€Œãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ï¼‰>>
- ãƒ‰ãƒ©ã‚¤ãƒ–ID: <<å–å¾—ã—ãŸãƒ‰ãƒ©ã‚¤ãƒ–ID>>

â–  è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç”¨
- target_site_hostname: <<ä¼šç¤¾å>>.sharepoint.com
- target_site_path: /sites/<<ã‚µã‚¤ãƒˆå>>
```

### ğŸ“ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Graph Explorer ã«ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†
- [ ] å¿…è¦ãªæ¨©é™ã«åŒæ„æ¸ˆã¿
- [ ] ãƒ†ãƒŠãƒ³ãƒˆIDå–å¾—ãƒ»ç¢ºèªå®Œäº†
- [ ] å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼IDå–å¾—å®Œäº†
- [ ] SharePointã‚µã‚¤ãƒˆæƒ…å ±å–å¾—å®Œäº†
- [ ] ãƒ‰ãƒ©ã‚¤ãƒ–IDå–å¾—å®Œäº†
- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°å®Œäº†
- [ ] **Azure ADã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç™»éŒ²æ¸ˆã¿ï¼ˆæœ¬ç•ªç’°å¢ƒç”¨ï¼‰**
- [ ] **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå®‰å…¨ã«ä¿å­˜æ¸ˆã¿ï¼ˆå†è¡¨ç¤ºä¸å¯ã®ãŸã‚ï¼‰**

---

## ğŸ” Azure ADã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç™»éŒ²ï¼ˆæœ¬ç•ªç’°å¢ƒç”¨ï¼‰

Graph Explorerã§æƒ…å ±å–å¾—å¾Œã€å®Ÿéš›ã®ç§»è¡Œãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã«ã¯Azure ADã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç™»éŒ²ãŒå¿…è¦ã§ã™ã€‚

### é‡è¦ãªæ‰‹é †

1. **Azure Portal** â†’ **Azure Active Directory** â†’ **ã‚¢ãƒ—ãƒªã®ç™»éŒ²** â†’ **æ–°è¦ç™»éŒ²**
2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼š`OneDrive-SharePoint-Migration-Tool`ï¼‰
3. **API ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯** ã§ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
   - `User.Read` (å§”ä»»)
   - `Sites.Read.All` ã¾ãŸã¯ `Sites.ReadWrite.All` (ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³)
   - `Files.Read.All` ã¾ãŸã¯ `Files.ReadWrite.All` (ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³)
4. **ç®¡ç†è€…ã®åŒæ„ã‚’ä¸ãˆã‚‹** ã‚’ã‚¯ãƒªãƒƒã‚¯
5. **è¨¼æ˜æ›¸ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ** â†’ **æ–°ã—ã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**

### âš ï¸ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®é‡è¦ãªæ³¨æ„äº‹é …

```
ğŸš¨ **çµ¶å¯¾ã«å¿˜ã‚Œãªã„ã§ãã ã•ã„** ğŸš¨

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ä½œæˆæ™‚ã«ä¸€åº¦ã ã‘è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

âœ… è¡¨ç¤ºã•ã‚ŒãŸã‚‰å³åº§ã«ã‚³ãƒ”ãƒ¼
âœ… å®‰å…¨ãªå ´æ‰€ã«ä¿å­˜ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ¨å¥¨ï¼‰
âœ… ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜éŒ²

âŒ ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã‚‹ã¨äºŒåº¦ã¨è¦‹ã‚Œã¾ã›ã‚“
âŒ å¿˜ã‚ŒãŸå ´åˆã¯æ–°ã—ã„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ã—ã‹ã‚ã‚Šã¾ã›ã‚“
âŒ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ã®ä¿å­˜ã¯éæ¨å¥¨ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ï¼‰
```

### å–å¾—ãŒå¿…è¦ãªæƒ…å ±

| é …ç›® | å ´æ‰€ | ç”¨é€” |
|------|------|------|
| **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ID** | æ¦‚è¦ãƒšãƒ¼ã‚¸ | `CLIENT_ID` ç’°å¢ƒå¤‰æ•° |
| **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆãƒ†ãƒŠãƒ³ãƒˆï¼‰ID** | æ¦‚è¦ãƒšãƒ¼ã‚¸ | `TENANT_ID` ç’°å¢ƒå¤‰æ•° |
| **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå€¤** | è¨¼æ˜æ›¸ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ | `CLIENT_SECRET` ç’°å¢ƒå¤‰æ•° |

---

**ğŸ’¡ Tips**: Graph Explorerã®ã‚¯ã‚¨ãƒªå±¥æ­´æ©Ÿèƒ½ã‚’æ´»ç”¨ã™ã‚‹ã¨ã€ã‚ˆãä½¿ã†ã‚¯ã‚¨ãƒªã‚’ç°¡å˜ã«å†å®Ÿè¡Œã§ãã¾ã™ã€‚ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ©Ÿèƒ½ã‚‚æ´»ç”¨ã—ã¦åŠ¹ç‡åŒ–ã‚’å›³ã‚Šã¾ã—ã‚‡ã†ã€‚
